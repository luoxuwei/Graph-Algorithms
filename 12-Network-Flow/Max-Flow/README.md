# 网络流模型和最大流问题

## 概念

1.网络流模型中的图，是一个有向图，有一个源点（入度为0），一个汇点（出度为0），边上有非负权值，表示容量。可以想成，这个有向图代表的模型是，比如说一个水管通路的模型，那么，源点
是初始的时候我们水龙头在的点，一旦把这个水龙头打开后，水就会源源不断的通过这个图中的有向边流到其他的点。在水流流向其他点的时候，没一条边就可以想象成是管道，这个管道是有容量的，
这个管道最多可以承载多少水流，最终水会汇入到汇点。通样像交通运输也是一个网络流的模型，每一个点代表一个城市，点和点之间的边代表运输线路，运输线路是有最大承载限制的，那就是所谓的容量
，那么我们现在想知道，从源点出发开始发车运送货物，运送途中必须满足每条公路上的容量限制，那么最终在我们的汇点能收到多少货物。再有，计算机网络也是网络流模型。这个模型本身实际上就是就是非常直观
的通过我们真实世界或者物理世界中的模型建立出来的。

2.在网络流模型中，边上的权值代表容量，可是在实际上，不管是水流，交通运输运的货物，或者网络中的数据包也好，它们实际通过这每一条通路相应的流量是多少了? 在网络流问题中，流量本身才是我们最关心的内容。
因为容量本身只是一个限制，一个约束条件，我们在边上的流量要满足这个约束条件，所谓的满足是，流量必须小于等于这个容量。所以实际，在画网络流的图时，我们在图中的边上写容量还不够，我们还要标上
真正的流量。

3.在初始的时候我们什么都没有发送，边上的流量都是0，每当我们发送一单位的货物的时候，它经过的路径上的每条边上的流量都要加1。当我们走不同的路径去运输货物的时候，都在经过的边上加上
对应的流量，有可能，有些边上流量已经等于容量了，那这个时候，我们发送货物的路径就不能再走这条边了。我们需要在图上再找其他线路。我们发送的货物在网络流模型中可以走不同的路线，当然也
可以走相同的路线，只需要满足整个网络流中的限制。

4.具体这个限制是什么，首先一个很明显的是容量限制。每条边经过的流量值是必须小于等于容量值的。还有就是平衡限制，在网络流中除了源点和汇点，其他的所有点，流入的流量应该等于流出的流量。当然
流量不一定非得从一条边出去，它可以从多条边出去。流入量和流出量都是所有出边入边上的流量相加的总和。 

5.在网络流中，从源点流出的流量，一定等于在汇点汇集的流量。最大流的问题就是指，在网络流模型中，最大的流量是多少，换句话说就是，在满足限制的条件下，最多能从源点发出多少流量，这些流量
存在在我们的网络中，既满足流量限制，有满足平衡限制。最终汇聚到汇点。这就是最大流问题。

##求解最大流问题

1.求解最大流问题，一个最常规的方式是Ford-FulKerson思想。Ford-FulKerson是一个算法框架，基于这个算法框架，我们可以有不同的实现。

2.在网络流问题中，当我们找到一条从源点都汇点的路径，这条路径能承载的最大的流量，应该是让整条路径中，那个容量最小的边填满。也就是在可以满足整条路径容量限制的基础上，可以达到的最大流量。
我们给这条路径上每条边的流量加上这个最大流量，然后在找其他满足容量限制的路径，在更新对应边上的流量。到我们再也找不到其他路径的时候我们就求得了一个最大的流量。但是不是我们每次都随便
从图中找一条路径，只要这条路径上的流量还没满的话，我们就可以添加新的流量，然后我们尝试让这条路径上的流量最大化，整个过程以此类推，最终是不是就可以求解最大流问题了。这个思想本身非常
的直观，但是很遗憾这个思想有一定的问题。

3.我们随便找一条路径，然后让这条路径上的流量最大化，可能会导致，有些边上的流量满后，因为无法再加流量而不能再被选择，会导致，整个图再也找不到一条在满足流量限制的条件下从源点通往汇点的路径了。
根据我们之前的介绍，至此我们这个算法就结束了，可是此时，我们求解出来的网络流中的流量，不是这张图的最大流量。随机选择的路径显然无法保证结果，任何可能都会有。我们完全可以构造出一个图
来验证。因此我们这个算法算是失败了。

4.那也意味着，我们还可以从图中我们还能找到一种方式，可以在图中添加更多的流量。依然是，我们从源点出发，找到一条还能添加流量的边，我们往这个图中就注入了新的流量，当这个新的流量，
走到已经有流量输入而且出边流量已经满了的点时，这个点流入的流量肯定大于流出的流量，不能满足平衡限制，所以在这里我们就可以尝试，从那个已经有流量输入到这个点的边减少流入同等的流量，我们可以想象成，从这条边逆流回到，这条边的上个节点
这个逆流的流量就与原先从这条边流入的流量产生抵消，这样以抵消，比如之前流入是3，现在要逆流2的流量，就等同于这天边只有1的流量。这就等同于虽然没有这条逆流的边，但由于这条边有流量，那么就可以
和新流入的流量抵消掉。那么这部分逆流的流量就来到了这条边的上一个节点，我们就可以找到还能添加流量的边，我们就走这条边，相应的流量我们就进行更新，我们就由找到了一条从源点到汇点的路径。我们
走这样的一条路径又从源点到汇点多输入了新的流量。我们多输入的这个流量的关键，是分析了，新的流量到达了，那个出边流量已满的这个点，虽然沿着原来网络的有向边不能走了，但是由于这个点
本身有流入的流量，那么这部分流量可以和新的流量抵消，因此我们相当于创建出了一条反向的边，我们顺着这条反向的边，又可以走到下一个顶点，我们又可以找到新的边。这样我们就找到了网络中的最大流。

5.这样的一个思想就是Ford-FulKerson思想，我们依然是从源点出发随便找一条路径，只要这条路径可以容纳新的流量，那么我们就可以往网络中注入新的流量，只不过在整个过程中，我们不能只看容量，
如果我们只看容量很有可能走入死胡同，但是如果在一条边中已经存在流量了，这就意味着，新的流量可以和这个已经存在的流量进行抵消，而反向的进行行走。这是新的我们可以往网络中添加流量的关键，
这样的一条边，我们称作反向边。这个概念代表的核心是，我们在找新的路径的时候，可以是看做有边的，这个边的容量是当前我们找到的网络模型中，流入的流量。实际我们工作的时候是有两条边的，原来的这条边
的容量是，这条边的最大容量减去已经流入的流量，这条新的反向边的容量是，原来这条边流入的流量。这两条边的权值计算方法是不同的，正向边的权值是容量减流量，而这个反向边所对应的权值其实就是这条正向边
现在的流量。那么我们就可以依靠这个逻辑对其他边也进行这样的建模。我们就创建了一个给每个边加上方向边的图，这样的图，实际上我们每次在整个网络流模型中找新的路径，看能不能向图中添加新的流量
实际上是在这个新创建的图上工作的。这个图通常被称作残量图 Residual Graph，非常好理解，就是对于我们原始的这个模型，各个边之间，现在还残留了多少流量可以供你选择，大家要注意的是对于
残量图来说，相当于两个边都能走，但是他们的权值可能是不同的。如果对原来的这个图中一条边V-W容量为C，我们现在找到的流量为F，那么在残量图中，从v到w v-w的权值就是C-F,求出的就是我们还能在
v-w这条边上多走多少的流量，而反过来从W到V W-V的权值就是我们当前找到的流量F，就是V-W上已经有多少流量了，那么反过来就有多少流量供你抵消。那么在整个残量图中我们只要能找到一条从源到汇点对应的路径
这里所谓的路径沿途上边对应的权值不能为0。那么这样的一条路径就一定能为整个网络流模型注入新的流量。整个流量大小就是沿途上边的最小值。那么这样的一条路径就是增广路径。增广路径就是指在残留图中我们还
能找到这样一个所有边权值还大于0的路径，这个路径肯定能注入新的流量。

6.Ford-FulKerson思想就是，我们从原始的图出发，创建残量图，在残量图中不断的找增广路径，当然每找到一个增广路径，就相当于我们图中的容量又增加了。流量增加后，我们残量图中，相应的权值。
要进行调整。调整完之后再继续找增广路径。直到没有增广路径。我们就找到了，原来图中的最大流。背后的道理也很好理解，我们能找到增广路径就表示我们还能往图中添加流量，那我们找不到增广路径了，
就表示我们无法向原来的图中再添加任何新的流量。此时我们求得的流量就是我们整个图的最大流。找增广路径的方法不同，那么所得到的的算法的时间复杂度就有可能不同，因此我们必须明确到底怎样找增广路径
才能得到具体的算法。


